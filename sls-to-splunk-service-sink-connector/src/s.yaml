edition: 3.0.0
name: sls-to-splunk-service-sink-connector-v3
access: default
vars:
  sinkEnv:
    PYTHONPATH: /code/python
    SPLUNK_HTTP_HOST: '{{splunkHTTPHost}}'
    SPLUNK_HTTP_PORT: '{{splunkHTTPPort}}'
    SPLUNK_HTTP_TOKEN: '{{splunkHTTPToken}}'
    SPLUNK_ENABLE_HTTPS: '{{splunkEnableHTTPS}}'
    SPLUNK_HTTP_TIMEOUT: '{{splunkHTTPTimeout}}'
    SPLUNK_ENABLE_SSL_VERIFY: '{{splunkEnableSSLVerify}}'
    SPLUNK_SOURCETYPE: '{{splunkSourceType}}'
    SPLUNK_INDEX: '{{splunkIndex}}'
    SPLUNK_SOURCE: '{{splunkSource}}'
template:
  template_{{functionName}}:
    internetAccess: true

resources:
  sink:
    component: fc3
    actions:
      pre-deploy:
        - component: fc3 build
          path: ./
    props:
      region: '{{region}}'
      role: '{{functionRoleArn}}'
      description: this is serverless sls to splunk service sink connector
      handler: index.handler
      environmentVariables: ${vars.sinkEnv}
      cpu: 0.35
      memorySize: 512
      diskSize: 512
      instanceLifecycleConfig:
        initializer:
          handler: index.initialize
          timeout: 60
      runtime: python3.10
      timeout: 600
      functionName: '{{functionName}}'
      code: ./sink
    extend:
      name: template_{{functionName}}
